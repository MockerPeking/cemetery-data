<!-- Team Reaper - Nina Benson, Nathan Wintersgill, Joe Yu, Lucas Morgan
 * index.java
 * The html file containing the map gui -->

<html>

<head>

<title>CrossRoad Cemetery Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/> <!-- stylesheet from leaflet -->

   <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script> <!-- header from leaflet -->

   <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script> <!-- header from turf.js -->

   <script type="text/javascript" src="mapGeneration.js"></script>
   <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
   <script src="jquery.csv.js"></script>

<style>
#map {
    width: 1960px;
    height:1080px; 
}

#iframe{
  width: 300px;
  height: 400px;
}

</style>

</head>

<body>

    <div id="map"></div>
    <div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>

<script>

    
    function getData(){
      x = $.post("/mapdata",dataType='http')
      return x;
    }

    var csv_cr = getData();

    var green = colorCode[0], yellow = colorCode[2], red = colorCode[1];

    // define the center point of the map
    var crossRoad_point = [40.436470, -79.770541], zoom = 17;

    //generate the map
    greatMap = mapGen(crossRoad_point, zoom);

    var popup = L.popup();


    function onMapClick(e){
        popup
        .setLatLng(e.latlng)
        .setContent(e.latlng.toString())
        .openOn(greatMap);
    }
    greatMap.on('click', onMapClick); // Click event, show LatLng in popup when clicked

    //setting up the icon

    var marker_crossroad = addCemetery(greatMap, "Crossroads Cemetery", [40.436470, -79.770541]);


  var crossRoad_coordinate =  [[
              -79.77008700370787,
              40.43747940085735
            ],
            [
              -79.77118670940399,
              40.43690778757614
            ],
            [
              -79.77209329605103,
              40.4362912563753
            ],
            [
              -79.77209329605103,
              40.436172849073685
            ],
            [
              -79.77159976959229,
              40.43600544529148
            ],
            [
              -79.76951837539673,
              40.435429736420026
            ],
            [
              -79.76950764656067,
              40.436401497468644
            ],
            [
              -79.77008700370787,
              40.43747940085735
            ]];

            
    function readData(csv){     
      var data_cem = $.csv.toArrays(csv);
      return data_cem;
    }

    var data_cr = readData(csv_cr);

    var num_entry = Math.round(Math.sqrt(data_cr.length * 1.9));

    var cr_grid = addGrid(numentry, numentry, crossRoad_coordinate);
    //console.log(cr_grid[0].features);

    for (var i = 0; i < data_cr.length; i++){
      var info_string = "First Name: " + data_cr[i][0] + "\n" + "Middle Name" + data_cr[i][1] + "\n" + "Last Name" + data_cr[i][2] + "\n" + "Birth Year" + data_cr[i][3] + "\n" + "Death Year" + data_cr[i][4] + "\n" + "Location" + data_cr[i][5] + "\n" + "Notes" + data_cr[i][6] + "\n";
      for (var j = 0; j < cr_grid.length; j++){
        if (cr_grid[j].features[0].properties.PlotNum == data_cr[i][9]){
          if (data_cr[i][8] == "t"){
            cr_grid[j].features[0].properties.style.fillColor = green;
          }
          else if (data_cr[i][7] == "t"){
            cr_grid[j].features[0].properties.style.fillColor = yellow;
          }
          cr_grid[j].features[0].properties.popupContent += info_string;
        }
      }
    }

    //cr_grid[55].features[0].properties.style.fillColor = green;


    for (i = 0; i < cr_grid.length; i++){
      L.geoJSON(cr_grid[i], {style: function (feature) {return feature.properties.style;}, onEachFeature: function (feature, layer) {layer.bindPopup(feature.properties.popupContent)}}).addTo(greatMap);

    }





    
</script>

</body>

</html>